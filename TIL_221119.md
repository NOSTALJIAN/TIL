# ❤️‍🔥 **TIL DAY 10** ❤️‍🔥

> 📆 2022년 11월 19일 토요일

<br>

---

<br>

낮에는 졸려 죽을거같았는데 아직도 못자는중... <br>
현재 시각은..... ![지금 시각](IMAGE/timeNow.png) <br>
하.. 오늘도 main class 충돌? 문제로 못찾아서 두세시간 날리고.. <br>
executeQuery() 메소드도 자꾸 오류떠서 거의 공부를 못한거같음... <br>
진짜 너무 속상하다.. 😶‍🌫️🤯🤬 <br>
<br>
어제 고생하던 에러가 ..^^ 내가 SELECT를 SECELT로 적어놨더라,,^^ <br>
될 리가 있나..^^ <br>

<br>

---

<br>

## 💡 트랜잭션 처리

> 트랜잭션: transaction

<br>

- 기능 처리의 최소 단위
  - 소작업들을 분리할 수 없음
  - 전체를 하나로 본다는 개념
- 하나의 기능은 여러 가지의 소작업들로 구성
  - 소작업들이 모두 성공하거나 모두 실패해야 함

<br>

### 🔖 계좌 이체

    # 두 개의 UPDATE 문이 필요 -> 모두 성공하거나 모두 실패해야 함
    ## 출금 작업
    UPDATE accounts SET balance=balance-이체금액 WHERE ano=출금계좌번호

    ## 입금 작업
    UPDATE accounts SET balance=balance+이체금액 WHERE ano=입금계좌번호

- 두 개의 계좌 금액을 수정하는 작업
- 출금 계좌에서 금액을 감소, 입금 계좌에서 금액을 증가시킴
  
<br>

### 🔖 `conn.setAutoCommit(false);`

❗️ **JDBC**에서는 `INSERT`, `UPDATE`, `DELETE` 문을 실행할 때마다 자동 커밋이 일어남

- 두가지 UPDATE 문을 실행할 때 문제가 됨
- 트랜잭션을 코드로 제어하려면 자동 커밋 기능을 꺼야 함

❗️ 자동 커밋 설정 여부는 **Connection**의 `setAutoCommit()` 메소드 사용

<br>

    # 자동 커밋 기능 끄기
    conn.setAutoCommit(false);

    # 자동 커밋 기능이 꺼진 후 사용하는 제어 코드
    conn.commit();      //  커밋하기
    conn.rollback();    //  롤백하기

- **DB**는 트랜잭션을 처리하기 위해 **커밋**과 **롤백**을 제공
- **커밋(commit)** : 내부 작업을 모두 **성공** 처리
- **롤백(rollback)** : 실행 전으로 돌아간다는 의미, 모두 **실패** 처리

<br>

### 🔖 트랜잭션을 위한 코드 작성 패턴

    Connection conn = null;
    try {
      //트랜잭션 시작 -----------------------------------------------
        //자동 커밋 기능 끄기
        conn.setAutoCommit(false);
        //소작업 처리
        ...
        //소작업 처리
        ...
        //커밋 -> 모두 성공 처리
        conn.commit();
      //트랜잭션 종료 -----------------------------------------------
    } catch (Exception e) {
      try {
        //롤백 -> 모두 실패 처리
        conn.rollback();
      } catch (SQLException e1) {}
    } finally {
      if(conn != null) {
        try {
          //원래대로 자동 커밋 기능 켜기
          conn.setAutoCommit(true);
          //연결 끊기
          conn.close();
        } catch (SQLException e) {}
      }
    }

<br>

[🔗 TransactionExample](https://github.com/NOSTALJIAN/JAVA/blob/6d83d23ae71c700f4a554b8fe1d871d9cb1967ff/Jian/jdbc/day02/Ex01_Transaction.java)